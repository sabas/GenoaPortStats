<!DOCTYPE html>
<html lang="en">
<head>
<title>Genoa Port Statistics - 2014 Terminal Traffic</title>
<meta charset="utf8"/>
<link rel="stylesheet" href="../script/ports.css" type="text/css"/>
<link rel="stylesheet" href="../script/leaflet.css" type="text/css"/>
<script type="text/javascript" src="../script/leaflet.js"></script>
<script type="text/javascript" src="../script/jquery-1.10.2.min.js"></script>

<script type="text/javascript" src="../script/jquery.sparkline.min.js"></script>
<script type="text/javascript" src="../script/jsonselect.min.js"></script>

<script type="text/javascript" src="terminal.inc.js"></script>
<script type="text/javascript" src="sparkdata2014.inc.js"></script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-13244504-2', 'stefanosabatini.eu');
  ga('send', 'pageview');
</script>
</head>
<body>
<div id="mapapp">
<div id="panel">
<a href="../index.html" class="entry">Indice</a>
<h1>Traffico Terminal 2014</h1>
<p>(<a href="terminal_alldata.csv">Tabella in CSV</a>), i dati sul posizionamento sono derivati da OpenStreetMap, la visualizzazione è effettuata con il Leaflet Data Visualizaton Framework.</p>
<p><a href="index.dvf.html">Versione (parziale) con Leaflet DVF</a></p>
</div>
<div id='map'></div>
</div>


<script type="text/javascript">
var layerurl = 'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
var	attr = 'Dati &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> sotto licenza ODBL';

var tile = new L.TileLayer(layerurl, {maxZoom: 18, attribution: attr});

var map= new L.Map('map', {layers: [tile]});

map.setView(new L.LatLng(44.4159,8.8456),13);
map.addLayer(tile);


function avg(arr){
 var sum = 0;
for(var i = 0; i < arr.length; i++){
    sum += parseInt(arr[i]);
}

var avg = sum/arr.length;
return avg.toFixed(2);
}

L.geoJson(term, {
        style:{'weight':2},
		onEachFeature: function onEachFeature(feature, layer) {
            if (feature.properties && feature.properties.id) {
            var content='<div style="line-height:30px;">';
            
            var query=JSONSelect.match(':has(.id:val("'+feature.properties.id+'"))',data);
            content+='<h1>'+query[0]['Nome']+'</h1><div class="datagrid"><table>';
            content+='<thead><tr><th>Merce</th><th>Unità</th><th></th><th>Media</th></tr></thead><tbody>';
            for(var i in query)
            {
			

             if (query[i] instanceof Array) continue;
             content+='<tr'+(i%2==1?' class="alt"':'')+'><td>'+query[i]['Merce']+'</td><td>'+query[i]['Unit']+'</td><td><span class="inlinesparkline">'+query[i]['data'].join(',')+'</span></td><td>'+avg(query[i]['data'])+'</td></tr>';
            }
            content+='</tbody></table></div></div>';
			layer.bindPopup(content,{'maxWidth':350});
		}
	}
}).addTo(map);

map.on('popupopen', function(e) {
  $('.inlinesparkline').sparkline('html',{'defaultPixelsPerValue':6,'height':'30px', tooltipFormat: '{{x:levels}} - {{y}}',
    tooltipValueLookups: {
        levels: $.range_map({ '0': 'gen-14','1': 'feb-14','2': 'mar-14','3': 'apr-14','4': 'mag-14','5': 'giu-14','6': 'lug-14','7': 'ago-14','8': 'set-14','9': 'ott-14','10': 'nov-14','11': 'dec-14' })
    }}); 
});
</script>
</body>
</html>
