<!DOCTYPE html>
<html lang="en">
<head>
<title>Genoa Port Statistics - 2013 Export Traffic (by port of discharge)</title>
<meta charset="utf8"/>
<link rel="stylesheet" href="../../script/ports.css" type="text/css"/>

<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
<script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
<script type="text/javascript" src="https://code.jquery.com/jquery-1.11.2.min.js"></script>

<script type="text/javascript" src="../../script/heatcanvas.js"></script>
<script type="text/javascript" src="../../script/heatcanvas-leaflet.js"></script>
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-13244504-2', 'stefanosabatini.eu');
ga('send', 'pageview');
</script>
</head>
<body>
<div id="mapapp">
<div id="panel">
<a href="../../global.html" class="entry">Index</a>
<a href="data/index.html" class="entry">Get the data</a>
<h1>2013 Export Traffic (by port of discharge)</h1>
<p>Click on the index to load the heatmap.</p>
<input type="radio" name="layerGroup" value="Containers full 20'" onclick="loadHeat(this.value)">Containers full 20'<br>
<input type="radio" name="layerGroup" value="Containers full 40'" onclick="loadHeat(this.value)">Containers full 40'<br>
<input type="radio" name="layerGroup" value="TEUS" onclick="loadHeat(this.value)" checked>TEUS<br>
<input type="radio" name="layerGroup" value="Containers empty 20'" onclick="loadHeat(this.value)">Containers empty 20'<br>
<input type="radio" name="layerGroup" value="Containers empty 40'" onclick="loadHeat(this.value)">Containers empty 40'<br>
<input type="radio" name="layerGroup" value="Containerised Cargo" onclick="loadHeat(this.value)">Containerised Cargo<br>
<input type="radio" name="layerGroup" value="Conventional Cargo" onclick="loadHeat(this.value)">Conventional Cargo<br>
<input type="radio" name="layerGroup" value="Liquid Bulk" onclick="loadHeat(this.value)">Liquid Bulk<br>
<input type="radio" name="layerGroup" value="Solid Bulk" onclick="loadHeat(this.value)">Solid Bulk<br>
<p class="i">There's also generic traffic related to: Spain (11026 tons), France (1991 tons) and other countries (136864,79 tons)</p>
</div>
<div id='map'></div>
</div>
<script type="text/javascript">
function loadLayer(file)
{
	var myLayer;
	$.ajax({
	async: false,
	url: file,
	dataType:"json",
	success: function(json) {
		myLayer=json;
		}
	});
	return myLayer;
}
function loadHeat(option){
if (heatmap.data.length>0) heatmap.clear();
	map.removeLayer(heatmap);
	map.removeLayer(markerLayers);

	var dataMax=100/Math.max.apply(Math,dataMap.map(function(o){return o[option];}));

	for(var k=0;k<dataMap.length;k++){
		var toHun=dataMax*dataMap[k][option];
		heatmap.pushData(dataMap[k]['lat'],dataMap[k]['lon'],toHun);
		var marker = new L.Marker(new L.LatLng(dataMap[k]['lat'],dataMap[k]['lon']));
		marker.bindPopup(dataMap[k]["Ports"]+" "+dataMap[k][option]);
		markerLayers.addLayer(marker);

	}
	map.addLayer(heatmap);
}

var layerurl = 'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
var	attr = 'Dati &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> sotto licenza ODBL';

var tile = new L.TileLayer(layerurl, {maxZoom: 18, attribution: attr});

var map= new L.Map('map', {layers: [tile]});

map.setView(new L.LatLng(0,0),2);
map.addLayer(tile);

L.marker([44.4492,8.8807]).addTo(map)
	.bindPopup('Genova');
	
var dataMap=loadLayer("data/globalTraffic_2013_discharge.json");


var markerLayers = new L.LayerGroup();
var heatmap = new L.TileLayer.HeatCanvas({},{'step':1, 'degree':HeatCanvas.LINEAR, 'opacity':0.4});

L.control.layers({"heatmap":heatmap}, {"markers": markerLayers}).addTo(map);

loadHeat('TEUS'); //default
</script>
</body>
</html>
