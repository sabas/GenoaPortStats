<!DOCTYPE html>
<html lang="en">
<head>
<title>Genoa Port Statistics - 2013 Loading Traffic Choropleth</title>
<meta charset="utf8"/>
<link rel="stylesheet" href="../script/normalize.css" type="text/css"/>
<link rel="stylesheet" href="../script/leaflet.css" type="text/css"/>
<script type="text/javascript" src="../script/leaflet.js"></script>
<script type="text/javascript" src="../script/jquery-1.10.2.min.js"></script>
<script type="text/javascript" src="../script/jquery.blockUI.js"></script>
<script type="text/javascript" src="../script/jsonselect.min.js"></script>
<script type="text/javascript" src="../script/topojson.v1.min.js"></script>

<style type="text/css">
	*{font-family:Helvetica;color:black;}
	h1,h3,a{color:#5b8fc9;}
	h1,h3,p{padding:3px;}

	html,body{height:100%}
  #mapapp{
	 height:100%; 
	 }
  #map {
  width:80%;
  min-height:500px;
  height:100%;
  float:right;
  }
  #panel{
   width:15%;
   float:left;
   padding:5px;
  }
  .entry{
	-moz-border-radius: 10px;
    border-radius: 10px;
    border:2px solid #ddeeff;
    padding:5px;
    margin:5px;
  }
    .i{font-style:italic;}
    .b{font-weight:bold;}
    input{width:100%;}
</style>

</head>
<body>
<div id="mapapp">
<div id="panel">
<a href="../index.html" class="entry">Indice</a>
<h1>Traffico Terminal 2012</h1>

</div>
<div id='map'></div>
</div>

<script type="text/javascript" src="nation.topojson"></script>
<script type="text/javascript">
var layerurl = 'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
var	attr = 'Dati &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> sotto licenza ODBL';

var tile = new L.TileLayer(layerurl, {maxZoom: 18, attribution: attr});

var map= new L.Map('map', {layers: [tile]});

map.setView(new L.LatLng(44.4159,8.8456),3);
map.addLayer(tile);
       
function getColor(d){
	var colors=['#FFF5EB','#FEE6CE','#FDAE6B','#FD8D3C','#F16913','#D94801','#A63603','#7F3603','#641B05']; //colorbrewer ed un pizzico di fantasia
	return colors[d];
}
function style(f)
{
	var max=jsonData.reduce(function(max, arr) { 
		return Math.max(max, arr[param]); 
	}, -Infinity);

	var p=JSONSelect.match(':has(.ISO_A3:val("'+f.properties.ISO_A3+'")) > .'+param,jsonData);
	if(typeof p === "undefined") return {
				weight: 2,
				opacity: 1,
				color: 'white',
				dashArray: '3',
				fillOpacity: 0.7
			}
			
    return {
        fillColor: getColor(Math.ceil(8*p/max)),
        weight: 2,
        opacity: 1,
        color: 'white',
        dashArray: '3',
        fillOpacity: 0.7
    };
}

var baseMaps = {
    "Base": tile
  };
  
var overlays = {
  };

L.control.layers(baseMaps, overlays).addTo(map);

var jsonData;
var param='TEUS';

function getBaseLayer(){
return $.getJSON('nation.topojson',function (feat) { 
    var county_geojson = topojson.feature(feat, feat.objects.ne_10m_admin_0_countries);
	var jsonlayer = L.geoJson(county_geojson, {
			style: style
		});
	map.addLayer(jsonlayer);
});
}

function colorize(){
return $.getJSON('loadingTraffic2013_imbarco_nazioni.json',function (json) { 
	jsonData=json;
});
}

function load(){
    $.blockUI({message: "Loading...", css: { backgroundColor: '#f00', color: '#fff'} });
	var loadingAddress = colorize();
    var loadingCustomer = getBaseLayer();
	$.unblockUI();
}

load();
</script>
</body>
</html>
