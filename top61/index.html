<!DOCTYPE html>
<html lang="en">
<head>
<title>Genoa Port Statistics - Yearly Traffic Top 61</title>
<meta charset="utf8"/>
<link rel="stylesheet" href="../script/ports.css" type="text/css"/>
<link rel="stylesheet" href="../script/leaflet.css" type="text/css"/>
<script type="text/javascript" src="../script/leaflet.js"></script>
<script type="text/javascript" src="../script/map.js"></script>
<script type="text/javascript" src="../script/jquery-1.10.2.min.js"></script>

<link rel="stylesheet" href="../script/jquery-ui.css" type="text/css"/>
<script type="text/javascript" src="../script/jquery-ui.js"></script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-13244504-2', 'stefanosabatini.eu');
  ga('send', 'pageview');
</script>

<script type="text/javascript">
var currentLayer='';

function toggleLayer(y,w)
{
    if(currentLayer!=''&&map.hasLayer(currentLayer)) map.removeLayer(currentLayer);
    map.addLayer(layers[y][w]);
    currentLayer=layers[y][w];
    $("#amount" ).html( '<p>You\'re watching '+y+' traffic ranked by '+w+'</p>' );
}

function getLayer(file, color)
{
    var max=0;
	var myJson;
	var myLayer;
	$.ajax({
		async: false,
		url: file,
		dataType:"json",
		success: function(json) {
		myJson=json;
		}
		});

		$.each(myJson['features'],function(i,j)
		{
			if(j['properties']['quantity']*1>max) max=j['properties']['quantity']; //*1 per forzare int
		});

	var coeff=maxsize/max;

		myLayer = L.geoJson(myJson,{
			onEachFeature:function onEachFeature(feature, layer) {
				if (feature.properties && feature.properties.port) {
                    var text="<span class='b'>Port:</span> "+feature.properties.port+"<br/><span class='b'>Quantity:</span> "+feature.properties.quantity;
					layer.bindPopup(text);
				}
			},
			pointToLayer: function (feature, latlng) {
				var qt=feature.properties.quantity*coeff;
				return L.circleMarker(latlng, { radius:qt, fillOpacity: 0.5, color: color });
				}
		});
	return myLayer;
}
</script>
</head>
<body>
<div id="mapapp">
<div id="panel">
<a href="../index.html" class="entry">Index</a>
<h1>Top 61 ports</h1>
<p>Choose traffic visualization (TEUs or TONs)</p>
<input type="radio" name="radiob" onclick="w=$('#slider').slider('option', 'value');toggleLayer(w,'teu')" checked="checked" value="teu"/>TEUs
<br/>
<input type="radio" name="radiob" onclick="w=$('#slider').slider('option', 'value');toggleLayer(w,'ton')" value="ton"/>TONs
<br/>
<p>Slide to see different years:</p>
<div id="slider"></div>
<div id="amount"></div>

<h3>Data download</h3>
<div class="datagrid">
<table>
<thead>
<tr><th>Index</th><th>Year</th><th>CSV</th><th>GeoJSON</th></tr>
</thead>
<tbody>
    <tr><td>TEU</td><td>2008</td><td><a href="data/gc_top61_teu_2008.csv">Download</a></td><td><a href="data/gc_top61_teu_2008.geojson">Download</a></td></tr>
    <tr><td>TON</td><td>2008</td><td><a href="data/gc_top61_ton_2008.csv">Download</a></td><td><a href="data/gc_top61_ton_2008.geojson">Download</a></td></tr>
    <tr><td>TEU</td><td>2009</td><td><a href="data/gc_top61_teu_2009.csv">Download</a></td><td><a href="data/gc_top61_teu_2009.geojson">Download</a></td></tr>
    <tr><td>TON</td><td>2009</td><td><a href="data/gc_top61_ton_2009.csv">Download</a></td><td><a href="data/gc_top61_ton_2009.geojson">Download</a></td></tr>
    <tr><td>TEU</td><td>2010</td><td><a href="data/gc_top61_teu_2010.csv">Download</a></td><td><a href="data/gc_top61_teu_2010.geojson">Download</a></td></tr>
    <tr><td>TON</td><td>2010</td><td><a href="data/gc_top61_ton_2010.csv">Download</a></td><td><a href="data/gc_top61_ton_2010.geojson">Download</a></td></tr>
    <tr><td>TEU</td><td>2011</td><td><a href="data/gc_top61_teu_2011.csv">Download</a></td><td><a href="data/gc_top61_teu_2011.geojson">Download</a></td></tr>
    <tr><td>TON</td><td>2011</td><td><a href="data/gc_top61_ton_2011.csv">Download</a></td><td><a href="data/gc_top61_ton_2011.geojson">Download</a></td></tr>
    <tr><td>TEU</td><td>2012</td><td><a href="data/gc_top61_teu_2012.csv">Download</a></td><td><a href="data/gc_top61_teu_2012.geojson">Download</a></td></tr>
    <tr><td>TON</td><td>2012</td><td><a href="data/gc_top61_ton_2012.csv">Download</a></td><td><a href="data/gc_top61_ton_2012.geojson">Download</a></td></tr>
    <tr><td>TEU</td><td>2013</td><td><a href="data/gc_top61_teu_2013.csv">Download</a></td><td><a href="data/gc_top61_teu_2013.geojson">Download</a></td></tr>
    <tr><td>TON</td><td>2013</td><td><a href="data/gc_top61_ton_2013.csv">Download</a></td><td><a href="data/gc_top61_ton_2013.geojson">Download</a></td></tr>
</tbody>
</tbody>
</tbody>
</tbody>
</tbody>
</table>
</div>

</div>
<div id='map'></div>
</div>

<script type="text/javascript">
var map = initmap(0,0,2, { });
putMarker(map,null,44.4492,8.8807,"Genova");

var ymin=2008;
var ymax=2013;
var maxsize=75; //dimensione cerchio

var layers={};

for(year=ymin;year<=ymax;year++)
{
layers[year]=[];
layers[year]['teu']=getLayer("./data/gc_top61_teu_"+year+".geojson", 'blue');
layers[year]['ton']=getLayer("./data/gc_top61_ton_"+year+".geojson", 'red');
}

$("#slider").slider({
      value:ymax,
      min: ymin,
      max: ymax,
      step: 1,
      slide: function( event, ui ) {
		var w=$("input[name='radiob']:checked").val();
		toggleLayer(ui.value,w);
      }
    });

toggleLayer(ymax,'teu');
</script>
</body>
</html>
