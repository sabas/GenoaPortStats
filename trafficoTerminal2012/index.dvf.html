<!DOCTYPE html>
<html lang="en">
<head>
<title>Genoa Port Statistics - 2012 Terminal Traffic</title>
<meta charset="utf8"/>
<link rel="stylesheet" href="../script/normalize.css" type="text/css"/>
<link rel="stylesheet" href="../script/leaflet.css" type="text/css"/>
<script type="text/javascript" src="../script/leaflet.js"></script>
<script type="text/javascript" src="../script/jquery-1.10.2.min.js"></script>

<style type="text/css">
*{font-family:Helvetica;color:black;}
h1,h3,a{color:#5b8fc9;}
h1,h3,p{padding:3px;}

html,body{height:100%}
  #mapapp{
	 height:100%; 
	 }
  #map {
  width:80%;
  min-height:500px;
  height:100%;
  float:right;
  }
  #panel{
   width:15%;
   float:left;
   padding:5px;
  }
  .entry{
	-moz-border-radius: 10px;
    border-radius: 10px;
    border:2px solid #ddeeff;
    padding:5px;
    margin:5px;
  }
    .i{font-style:italic;}
    .b{font-weight:bold;}
    input{width:100%;}
</style>
	<script type="text/javascript" src="../script/jsts/javascript.util.js"></script>
	<script type="text/javascript" src="../script/jsts/jsts.js"></script>
    <link rel="stylesheet" href="../script/dvf.css" type="text/css"/>
<script type="text/javascript" src="../script/leaflet-dvf.min.js"></script>

</head>
<body>
<div id="mapapp">
<div id="panel">
<a href="../index.html" class="entry">Indice</a>
<h1>Traffico Terminal 2012</h1>
<p><a href="terminal_alldata.csv">Tabella in CSV</a>), i dati sul posizionamento sono derivati da OpenStreetMap, la visualizzazione è effettuata con il Leaflet Data Visualizaton Framework.</p>
<p>Di tutti i dati al momento sono visualizzate solamente le quantità di contenitori movimentati.</p>
<p><a href="index.sparklines.html">Versione con sparklines</a></p>
</div>
<div id='map'></div>
</div>

<script src="terminal.inc.js"></script>
<script src="data.inc.js"></script>

<script type="text/javascript">
var layerurl = 'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
var	attr = 'Dati &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> sotto licenza ODBL';

var tile = new L.TileLayer(layerurl, {maxZoom: 18, attribution: attr});

var map= new L.Map('map', {layers: [tile]});

map.setView(new L.LatLng(44.4159,8.8456),13);
map.addLayer(tile);


  var categories = ['gen-12', 'feb-12', 'mar-12', 'apr-12','mag-12', 'giu-12', 'lug-12', 'ago-12','set-12', 'ott-12', 'nov-12', 'dic-12'];
  var fillColorFunctionBars = new L.HSLLuminosityFunction(new L.Point(0, 0.5), new L.Point(categories.length - 1, 1), {
    outputHue: 0,
    outputSaturation: '100%'
  });
  var styleFunction = new L.StylesBuilder(categories, {
    displayName: function(index) {
      return categories[index];
    },
    color: 'hsl(0,100%,20%)',
    fillColor: fillColorFunctionBars,
    minValue: 0,
    maxValue: 10000 //300000000
  });

  options = {
    locationMode: L.LocationModes.LOOKUP,
    recordsField: null,
    codeField: 'id',
    locationLookup: terminal,
    locationTextField: 'id',
    includeBoundary: true,
	boundaryStyle:{ color:'#f00'},
    chartOptions: styleFunction.getStyles(),
    layerOptions: {
      fillOpacity: 0.7,
      opacity: 1,
      weight: 1,
      width: 5
    },
    tooltipOptions: {
      iconSize: new L.Point(100, 65),
      iconAnchor: new L.Point(-5, 65)
    },

    onEachRecord: function(layer, record) {

      var $html = L.HTMLUtils.buildTable(record);

      layer.bindPopup($html.wrap('<div/>').parent().html(), {
        maxWidth: 400,
        minWidth: 400
      });
    
    }
  };

  var dataBarChart = new L.BarChartDataLayer(datacsv, options);


		var legendControl = new L.Control.Legend();
		legendControl.addTo(map);
        
  var baseMaps = {
    "Base": tile
  };
  
var overlays = {
    "Barchart": dataBarChart.addTo(map)
  };

  L.control.layers(baseMaps, overlays).addTo(map);
</script>
</body>
</html>
